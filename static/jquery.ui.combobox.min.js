!function(e){e.widget("ui.combobox",e.ui.autocomplete,{options:{minLength:2,ajaxGetAll:{get:"all"},decoratorField:null},_create:function(){if(this.element.is("SELECT"))this._selectInit();else{e.ui.autocomplete.prototype._create.call(this);var t=this.element;t.addClass("ui-widget ui-widget-content ui-corner-left").click((function(){this.select()})),this.button=e("<button type='button'>&nbsp;</button>").attr("tabIndex",-1).attr("title","Show All Items").insertAfter(t).button({disabled:!0,icons:{primary:"ui-icon-triangle-1-s"},text:!1}).removeClass("ui-corner-all").addClass("ui-corner-right ui-button-icon").click((function(o){var i=t.data("ui-combobox");clearTimeout(i.closing),t.isFullMenu||i._swapMenu(),t.combobox("widget").css("display","block").position(e.extend({of:t},i.options.position)),t.focus(),i._trigger("open"),t.combobox("widget").zIndex()<=t.parent().zIndex()&&t.combobox("widget").zIndex(t.parent().zIndex()+1)})),e(document).queue((function(){var o=t.data("ui-combobox");e.isArray(o.options.source)?e.ui.combobox.prototype._renderFullMenu.call(o,o.options.source):"string"==typeof o.options.source?e.getJSON(o.options.source,o.options.ajaxGetAll,(function(t){e.ui.combobox.prototype._renderFullMenu.call(o,t)})):e.ui.combobox.prototype._renderFullMenu.call(o,o.source())}))}},_renderFullMenu:function(t){var o=this,i=this.element,n=i.data("ui-combobox").menu.element,l=[];t=this._normalize(t),i.data("ui-combobox").menuAll=i.data("ui-combobox").menu.element.clone(!0).appendTo("body")[0];for(var s=0;s<t.length;s++){var u=t[s],r=u.label;if(null!=this.options.decoratorField){var a=u[this.options.decoratorField]||u.option&&e(u.option).attr(this.options.decoratorField);null!=a&&(r=r+" "+a)}l[s]='<li class="ui-menu-item" role="menuitem"><a class="ui-corner-all" tabindex="-1">'+r+"</a></li>"}n[0].innerHTML=l.join(""),this._resizeMenu();var c=e("li",n).on("mouseover","mouseout",(function(t){"mouseover"==t.type?o.menu.focus(t,e(this)):o.menu.blur()}));for(s=0;s<c.length;s++)e(c[s]).data("ui-autocomplete-item",t[s]);i.isFullMenu=!0,this._swapMenu(),o.button.button("enable"),setTimeout((function(){e(document).dequeue()}),0)},_renderItem:function(t,o){var i=o.label.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+e.ui.autocomplete.escapeRegex(this.term)+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>");if(null!=this.options.decoratorField){var n=o[this.options.decoratorField]||o.option&&e(o.option).attr(this.options.decoratorField);null!=n&&(i=i+" "+n)}return e("<li></li>").data("ui-autocomplete-item",o).append("<a>"+i+"</a>").appendTo(t)},close:function(){this.element.isFullMenu&&this._swapMenu(),e.ui.autocomplete.prototype.close.call(this)},destroy:function(){if(this.element.is("SELECT"))return this.input.removeData("ui-combobox","menuAll"),this.input.remove(),void this.element.removeData().show();e.ui.autocomplete.prototype.destroy.call(this),this.element.removeClass("ui-widget ui-widget-content ui-corner-left"),this.button.remove()},search:function(t,o){this.element.isFullMenu&&this._swapMenu(),e.ui.autocomplete.prototype.search.call(this,t,o)},_change:function(t){if(!this.selectedItem){var o=new RegExp("^"+e.ui.autocomplete.escapeRegex(this.element.val())+"$","i"),i=e.grep(this.options.source,(function(e){return o.test(e.label)}));if(i.length)null!=i[0].option&&(i[0].option.selected=!0);else{if(this.options.selectElement){var n=this.options.selectElement.children("option:first");this.element.val(n.text()),n.prop("selected",!0)}else this.element.val("");e(t.target).data("ui-combobox").previous=null}}e.ui.autocomplete.prototype._change.call(this,t)},_swapMenu:function(){var e=this.element,t=e.data("ui-combobox"),o=t.menuAll;t.menuAll=t.menu.element.hide()[0],t.menu.element[0]=o,e.isFullMenu=!e.isFullMenu},_selectInit:function(){var t=this.element,o=t.attr("class"),i=t.attr("style"),n=t.children(":selected"),l=e.trim(n.text());t.hide(),this.options.source=t.children("option").map((function(){return{label:e.trim(this.text),option:this}})).toArray();var s=this.options.select,u=this.options.selected;this.options.select=function(e,o){o.item.option.selected=!0,t.change(),s&&s(e,o),u&&u(e,o)},this.options.selectElement=t,this.input=e("<input>").insertAfter(t).val(l),i&&this.input.attr("style",i),o&&this.input.attr("class",o),this.input.combobox(this.options)},inputbox:function(){return this.element.is("SELECT")?this.input:this.element}})}(jQuery);