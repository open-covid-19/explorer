function setting(e,t){null===t?sessionStorage.removeItem(e):sessionStorage.setItem(e,t)}function loadData(e,t){(e=e||Object.keys(OPEN_COVID_CONFIG.tables)).forEach((e=>async function(e,a){const n=Math.round(Date.now()/1e3/60),o=`${OPEN_COVID_CONFIG["data-url"]}/v3/${a}`,r=await loadJSON(`${o}?cache=${n}`);t(e,r)}(e,`${e}.csv`)))}async function loadLocationData(e){return"CSV"===CURRENT_OPTIONS["read-format"]?await loadCSV(`${CURRENT_OPTIONS["data-url"]}/v3/location/${e}.csv`):tableToRecords(await loadJSON(`${CURRENT_OPTIONS["data-url"]}/v3/location/${e}.json`))}function tableToRecords(e){return e.data.map((t=>e.columns.reduce(((e,a,n)=>Object.assign(e,{[a]:t[n]})),{})))}function removeEmptyColumns(e){const t=[];return e.forEach((e=>{Object.keys(e).forEach((a=>{e[a]&&t.push(a)}))})),e.map((e=>t.reduce(((t,a)=>Object.assign(t,{[a]:e[a]})),{})))}function retryCallback(e){let t=0;const a=setInterval((()=>{try{e(),clearInterval(a)}catch(e){console.error("Callback failed: "+ ++t,e),t>=32&&clearInterval(a)}}),250)}async function loadResource(e){const t=await fetch(e);if(t.ok)return t;throw new Error("Response failed")}function loadJSON(e,t=!1){return e in CACHE.JSON||(CACHE.JSON[e]=new Promise((async(a,n)=>{t&&(e=`https://cors-anywhere.herokuapp.com/${e}`),loadResource(e).then((e=>e.json().then(a))).catch(n)}))),CACHE.JSON[e]}function loadCSV(e,t=!1){return e in CACHE.CSV||(CACHE.CSV[e]=new Promise((async(a,n)=>{t&&(e=`https://cors-anywhere.herokuapp.com/${e}`);const o=await loadResource(e),r=await o.text();Papa.parse(r,{header:!0,delimiter:",",skipEmptyLines:!0,complete:e=>{e.errors.length>0?n(e.errors[0]):a(e.data)}})}))),CACHE.CSV[e]}function recordsToDataTable(e,t=null){const a=[t=t||Object.keys(e[0])].concat(e.map((e=>t.map((t=>e[t])))));return google.visualization.arrayToDataTable(a)}function loadGoogleCharts(e=["corechart"]){const t=e.join(",");return t in CACHE.gcharts||(CACHE.gcharts[t]=google.charts.load("current",{packages:e})),CACHE.gcharts[t]}function filterDataIndices(e,t=0,a=null){let n=e.map(((e,t)=>Object.assign({},e,{idx:t})));if(CURRENT_OPTIONS["skip-until-outbreak"]){const e=CURRENT_OPTIONS["outbreak-threshold-ratio"],a=Math.max(...n.filter((e=>e.date<"2020-06-01"&&!Number.isNaN(e.new_confirmed))).map((e=>e.new_confirmed))),o=n.map(((t,n)=>(Number(t.new_confirmed)||0)/e>a?n:null)).filter((e=>e))[0];n=n.slice(Math.max(0,o-t))}if(CURRENT_OPTIONS["min-date"]){const e=n.map(((e,t)=>e.date>=CURRENT_OPTIONS["min-date"]?t:null)).filter((e=>e))[0];n=n.slice(Math.max(0,e-t))}if(CURRENT_OPTIONS["max-date"]){const e=n.map(((e,t)=>e.date<=CURRENT_OPTIONS["max-date"]?t:null)).filter((e=>e)).slice(-1)[0];n=n.slice(0,Math.min(n.length,e))}const o=a||["new_confirmed","new_deceased"],r=e=>n.slice(0,1)[0][e],c=e=>""===e||null===e||Number.isNaN(e);for(;o.every((e=>c(r(e))));)n.shift();const s=e=>n.slice(-1)[0][e];for(;o.every((e=>c(s(e))));)n.pop();if("ontouchstart"in document.documentElement){const e=CURRENT_OPTIONS["history-size-mobile"];n=n.slice(-e-t)}else if(CURRENT_OPTIONS["history-size-limit"]>0){const e=CURRENT_OPTIONS["history-size-limit"];n=n.slice(-e-t)}return n.map((e=>e.idx))}function mapToNumeric(e,t,a=!0){return t=t.concat(["new_confirmed","new_deceased"]),e.map((e=>{const n=Object.assign({},e);return t.forEach((e=>{const t=parseInt(n[e]);null===n[e]||Number.isNaN(t)?n[e]=Number.NaN:n[e]=a?Math.max(0,t):t})),n}))}function chartLabel(e){return e+(CURRENT_OPTIONS["shareable-charts"]?` in ${window.locationLabel}`:"")}function mergeAgeBins(e,t){const a=["80-89","80-90","90-99","90-100","90-","100-"];return e.map((e=>{e=Object.assign({},e);const n=Object.keys(e).filter((e=>e.startsWith("age_bin_"))).reduce(((t,a,n)=>Object.assign(t,{[n]:e[a]})),{});if(Object.keys(n).map((e=>n[e])).includes("80-"))return e;const o=Object.keys(n).filter((e=>a.includes(n[e])));o.forEach((t=>{e[`age_bin_${t}`]=""}));const r=o[0];return e[`${t}_age_${r}`]=o.reduce(((a,n)=>a+e[`${t}_age_${n}`]),0),e[`age_bin_${r}`]="80-",e}))}function colorScaleValue(e,t,a){const n=1-a,[o,r,c]=e,[s,i,l]=t,[u,d,m]=[Math.round(o*n+s*a),Math.round(r*n+i*a),Math.round(c*n+l*a)],[f,N,O]=[u,d,m].map((e=>("00"+e.toString(16)).slice(-2)));return"#"+[f,N,O].join("")}function*colorScaleGenerator(e,t,a){for(let n=0;n<a-1;n++)yield colorScaleValue(e,t,n/(a-1));yield colorScaleValue(e,t,1)}