<!-- Wrap the whole widget into a DIV -->
<div id="age-stratified-active-cases" style="visibility: hidden;">
    <p style="text-align: end; font-size: small;">
        Infection rates are computed as the 14-day rolling sum of cases per 1,000
    </p>
    <div class="spacer"></div>
    <div class="spacer"></div>

    <script async>!async function(){const e=["age_bin_0","age_bin_1","age_bin_2","age_bin_3","age_bin_4","age_bin_5","age_bin_6","age_bin_7","age_bin_8","age_bin_9","new_confirmed_age_0","new_confirmed_age_1","new_confirmed_age_2","new_confirmed_age_3","new_confirmed_age_4","new_confirmed_age_5","new_confirmed_age_6","new_confirmed_age_7","new_confirmed_age_8","new_confirmed_age_9","population_age_00_09","population_age_10_19","population_age_20_29","population_age_30_39","population_age_40_49","population_age_50_59","population_age_60_69","population_age_70_79","population_age_80_and_older"],a=document.currentScript.parentElement,_=new URLSearchParams(location.search).get("key");let n=await loadLocationData(_);if(n.filter(a=>e.some(e=>a[e]&&""!==a[e])).length<34)return console.error("Not enough records found for columns:",e),void(a.style.display="none");const o=e.filter(e=>e.startsWith("new_confirmed_age_")),t=e.filter(e=>!e.startsWith("age_bin_"));n=mapToNumeric(n,t,!0);const i=new Set(filterDataIndices(n,14)),r=(e=>Object.keys(e).filter(e=>e.startsWith("age_bin_")).map(a=>e[a]))((n=n.filter((e,a)=>i.has(a)).filter(a=>e.some(e=>!Number.isNaN(a[e])))).slice(-7)[0]).reduce((e,a,_)=>{const[n,o]=a.split("-",2).map(e=>parseInt(e));return n%10!=0||o!==n+9&&o!==n+10?80!==n&&90!==n||!Number.isNaN(o)||(e[a]=`population_age_${n}_and_older`):e[a]=`population_age_${n}_${n+9}`,e},{"80-":"population_age_80_and_older"}),c=n.reduce((a,_)=>(e.forEach(e=>{const n=`age_bin_${e.split("_").slice(-1)[0]}`;_[n]&&(a[e]=_[n])}),a),{}),l=n.map((e,a)=>{const _={Date:e.date},t=Math.max(0,a-14);o.forEach(o=>{const i=c[o];if(e[o]){const e=n.slice(t,a).reduce((e,a)=>e+(parseInt(a[o])||0),0);_[i]=e}else i&&(_[i]=Number.NaN)});const i=Object.keys(r).map(e=>r[e]);return i.includes("population_age_80_89")&&i.includes("population_age_90_and_older")&&(_["80-"]=_["80-89"]+_["90-"],delete _["80-89"],delete _["90-"]),Object.keys(r).forEach(a=>{"80-89"!==a&&"90-"!==a&&(_[a]=1e3*_[a]/e[r[a]])}),_}).slice(14);await loadGoogleCharts(["corechart"]);const s=attachElement("div",{},a,prepend=!0);new google.visualization.LineChart(s).draw(recordsToDataTable(l),Object.assign({},GOOGLE_CHARTS_CONFIG,{title:chartLabel("Infection rates by age group"),curveType:"function",legend:{position:"in"},colors:void 0,interpolateNulls:!0})),a.style.visibility="visible",document.querySelector("#active-cases").style.display="none"}();</script>
</div>