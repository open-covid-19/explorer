<!DOCTYPE html><html><!-- HTML page head --><head>
    <!-- HTML metadata -->
    <meta charset="UTF-8">
    <title>COVID-19 Open Data Explorer</title>
    <meta name="description" content="Interactive map for the COVID-19 Open Data Project">
    <link rel="icon" type="image/png" href="../static/logo-64.png">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="COVID-19 Open Data Explorer">

    <!-- Homescreen icons -->
    <link rel="apple-touch-icon" href="../static/icon-64x64.png">
    <link rel="apple-touch-icon" sizes="64x64" href="../static/icon-64x64.png">
    <link rel="apple-touch-icon" sizes="128x128" href="../static/icon-128x128.png">
    <link rel="apple-touch-icon" sizes="512x512" href="../static/icon-512x512.png">

    <!-- Capabilities-related metadata -->
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">

    <!-- Google Fonts -->
    <link href="//fonts.googleapis.com/css?family=Roboto:100,300,400,500,700|Google+Sans:400,500|Product+Sans:400&amp;lang=en" rel="stylesheet">

    <!-- JQuery and plugins -->
    <script type="text/javascript" src="../third_party/jquery/dist/jquery.min.js"></script>
    <script type="text/javascript" src="../third_party/jquery-ui-dist/jquery-ui.min.js"></script>
    <script type="text/javascript" src="../static/jquery.ui.combobox.min.js"></script>
    <link rel="stylesheet" href="../third_party/jquery-ui-dist/jquery-ui.min.css">

    <!-- Google Charts -->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

    <!-- MomentJS -->
    <script type="text/javascript" src="../third_party/moment/min/moment.min.js"></script>

    <!-- CSV Parsing -->
    <script type="text/javascript" src="../third_party/papaparse/papaparse.min.js"></script>

    <!-- Character transliteration -->
    <script type="text/javascript" src="../third_party/transliteration/dist/browser/bundle.umd.min.js"></script>

    <!-- Custom styles -->
    <link rel="stylesheet" href="https://pair-code.github.io/covid19_symptom_dataset/style.css">
    <link rel="stylesheet" href="../third_party/picnic/picnic.min.css">
    <link rel="stylesheet" href="../static/styles.min.css">

    <!-- Polyfills, custom functions and constants -->
    <script type="text/javascript" src="../static/cache.min.js"></script>
    <script type="text/javascript" src="../static/polyfills.min.js"></script>
    <script type="text/javascript" src="../static/open-covid-19.min.js"></script>
    <script type="text/javascript">const DEFAULT_OPTIONS={"data-url":"https://storage.googleapis.com/covid19-open-data","skip-until-outbreak":!0,"outbreak-threshold-ratio":.05,"read-format":"JSON","shareable-charts":!0,"min-date":"2020-09-01","max-date":null},CURRENT_OPTIONS=Object.keys(DEFAULT_OPTIONS).reduce((e,t)=>Object.assign(e,{[t]:sessionStorage.getItem(t)||DEFAULT_OPTIONS[t]}),{}),_CFG=Object.assign({tables:{index:"Index",demographics:"Demographics",economy:"Economy",epidemiology:"Epidemiology",geography:"Geography",health:"Health",hospitalizations:"Hospitalizations",mobility:"Mobility","oxford-government-response":"Oxford Government Response","lawatlas-emergency-declarations":"LawAtlas Emergency Declarations",weather:"Weather",worldbank:"Worldbank","by-age":"Breakdown by Age","by-sex":"Breakdown by Sex","google-search-trends":"Google Search Trends"}},CURRENT_OPTIONS);GOOGLE_CHARTS_CONFIG=window.GOOGLE_CHARTS_CONFIG||{theme:"material",colors:["#BF360C"],backgroundColor:{fill:"#FCFCFC"},legend:{position:_CFG.chart_legend_position||"none"},chartArea:{width:"100%",height:"100%",left:parseInt(_CFG.chart_padding_left||64),bottom:parseInt(_CFG.chart_padding_bottom||48),top:parseInt(_CFG.chart_padding_top||24)},titlePosition:"in",axisTitlesPosition:"in",hAxis:{textPosition:"bottom"},vAxis:{textPosition:"out",viewWindow:{min:0}},height:parseInt(_CFG.chart_height||300)};</script>


<!-- Google Charts -->
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

<script type="text/javascript">let chartLoaded=!1;const pendingCallbacks=[];window.chart=function(a){chartLoaded?retryCallback(a):pendingCallbacks.push(a)},google.charts.load("current",{packages:["corechart","bar","sankey","table"],callback:()=>{chartLoaded=!0,pendingCallbacks.forEach(a=>retryCallback(a))}});</script>

<style>#table-picker{padding-left:8px}.table-wrapper{max-height:400px;overflow-y:auto}</style>

</head><body class="single-column">

    <!-- Header with links -->
    <header>
    <div class="glue-header__logo-container ">
        <a href="https://www.google.com/" style>
            <svg role="img" aria-hidden="true" class="glue-header__logo-svg">
                <use xlink:href="../glue/glue-icons.svg#google-color-logo"/>
            </svg>
        </a>
    </div>
</header>

<h1 class="centered glue-headline glue-headline--headline-1">
    <a href=".." style="text-decoration: none; color: initial;">COVID-19 Open-Data</a>
</h1>

    <main>
        <h1 class="centered">COVID-19 Data Status Dashboard</h1>

        <div class="spacer"></div>

        <h2 class="centered">Stale data sources</h2>
        <div class="table-wrapper">
            <table id="table-metadata" class="fullwidth"></table>
        </div>

        <div class="spacer"></div>

        <h2 class="centered">Locations with stale data</h2>
        <select id="table-picker" class="fullwidth">
            <option disabled selected>Select Table</option>
        </select>
        <div class="table-wrapper">
            <table id="table-stale" class="fullwidth"></table>
        </div>

        <script>
            (async function () {
                const staleLimit = moment().subtract(14, 'days').startOf('day');

                const metadataUrl = `${_CFG['data-url']}/v3/metadata.json`;
                const metadata = await fetch(metadataUrl).then(res => res.json());

                $('#table-picker').html(
                    [`<option disabled selected>Select Table</option>`]
                        .concat(metadata.tables
                            .map(table => table.name)
                            .map(x => `<option value="${x}">${x}</option>`))
                        .join(''));

                $('#table-picker').on('change', async () => {

                    // Get the latest data to determine stale locations
                    const tableName = $('#table-picker').val();
                    const latestDataUrl = `${_CFG['data-url']}/v3/latest/${tableName}.json`;
                    const latestData = await fetch(latestDataUrl).then(res => res.json());

                    const staleLocations = latestData.data.reduce((acc, row) => {
                        const record = latestData.columns
                            .reduce((dict, x, idx) => Object.assign(dict, { [x]: row[idx] }), {});

                        let simpleLocation = record.location_key;
                        const tokens = simpleLocation.split('_');
                        if (tokens.length === 2) simpleLocation = `${tokens[0]}_*`;
                        if (tokens.length === 3) simpleLocation = `${tokens[0]}_${tokens[1]}_*`;

                        const date = moment(record.date).startOf('day');
                        if (acc[simpleLocation]?.isBefore(date) ?? true) acc[simpleLocation] = date;
                        return acc;
                    }, {});

                    $('#table-stale').html(
                        ['<tr><th>Location</th><th>Last Update</th></tr>']
                            .concat(Object.entries(staleLocations)
                                .filter(([location, date]) =>
                                    date?.isBefore(staleLimit) ?? true)
                                .map(([location, date]) =>
                                    `<tr><td>${location}</td><td>${date?.format('YYYY-MM-DD') || 'Unknown'}</td></tr>`)
                                .join('')
                            )
                    );
                });

                $('#table-picker').val('epidemiology');
                $('#table-picker').trigger('change');

                const versionsUrl = `${_CFG['data-url']}/v3/versions.json`;
                const versions = await fetch(versionsUrl).then(res => res.json());
                const lastUpdated = Object.keys(versions).reduce((acc, x) => {
                    const prefix = 'intermediate/';
                    if (x.startsWith(prefix)) acc[x.slice(prefix.length).replace('.csv', '')] = moment(versions[x][0] / 1000);
                    return acc;
                }, {});
                $('#table-metadata').html(
                    [`<tr><th>Data Source</th><th>Class Name</th><th>Table</th><th>Last Update</th></tr>`]
                        .concat(metadata.sources
                            .filter(x =>
                                lastUpdated[x.uuid]?.isBefore(staleLimit) ?? true)
                            .map(x =>
                                `<tr>
                                <td>${x.label || ''}</td>
                                <td>${x.class}</td>
                                <td>${x.table}</td>
                                <td>${lastUpdated[x.uuid]?.format('YYYY-MM-DD') || 'Unknown'}</td>
                                </tr>`))
                )
            })();
        </script>
    </main>

    <!-- Load analytics at the end of the page -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-53249564-6"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-53249564-6");</script>



</body></html>